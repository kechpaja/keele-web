<html>
    <head>

    </head>

    <body>
        <div id="image-container"></div>

        <script type="text/javascript">
            var tickSize = 0.05; // Percentage of page height
            var tickLength = 5; // Milliseconds

            var imageMaxHeight = 25; // Percentage of page height

            var imageContainer = document.getElementById("image-container");

            // Function to create image tile
            function createImageTile(src, id) { /// TODO will eventually take src as base64-encoded img, right?
                var image = document.createElement("img");
                image.src = src; //"img/horn.jpg";
                image.id = id; 
                image.style = "position: absolute; left: 50%; bottom: 100%; transform: translate(-50%, 0)";
                image.style["max-height"] = imageMaxHeight + "%";
                return image;
            }

            //imageContainer.appendChild(image);

            for (var i = 0; i < 2; i++) {
                imageContainer.appendChild(createImageTile("img/horn.jpg", "horn" + i));
            }


            //while (parseInt(image.style.top) < 100) {
            //    image.style.top = (parseInt(image.style.top) + 5) + "%";
            //}

            // XXX sleep function from https://stackoverflow.com/a/39914235
            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }


            // Function to advance a tile by one tick
            function advanceTile(tile, nextTile) {
                var stoppingPoint = 0; // TODO top of nextTile if nextTile is not null, otherwise 0

                if (nextTile !== null) {
                    stoppingPoint = parseFloat(nextTile.style.bottom) + imageMaxHeight
                }

                var tileBottomPosition = parseFloat(tile.style.bottom);
                if (tileBottomPosition > stoppingPoint) {
                    tile.style.bottom = (tileBottomPosition - tickSize) + "%";
                    return true;
                }

                return false;
            }

            async function runWaterfall() {
                // TODO set up win/lose conditions for while loop
                while (true) {
                    var tiles = imageContainer.getElementsByTagName("img");
                    var lastTile = null;
                    for (var i = 0; i < tiles.length; i++) {
                        if (advanceTile(tiles[i], lastTile)) {
                            break;
                        }

                        lastTile = tiles[i];
                    }

                    await sleep(tickLength);
                }
            }

            //runWaterfall();


            /*
             * Scripts for removing a tile when the correct answer is given
             */

             function checkAnswer(e) {
                if (e.keyCode == 13 || e.which == 13) {
                    var answerElement = document.getElementById("answer-field");
                    var text = answerElement.value;
                    answerElement.value = "";

                    // Remove tile if answer is correct
                    var container = document.getElementById("image-container");
                    var tiles = container.getElementsByTagName("img");
                    if (tiles[0].id === text) { // TODO look up actual answers using ID
                        tiles[0].remove();
                    }
                }
             }

        </script>

        <button onclick="javascript:runWaterfall()">Start</button>

        <input type="text" id="answer-field" onkeypress="javascript:checkAnswer(event)" />

        <!-- <img src="img/horn.jpg" style="position: absolute; left: 50%; top: 0%; transform: translate(-50%, -100%)"> -->
    </body>
</html>
